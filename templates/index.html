<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Solarthermie Dashboard</title>
<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: #1e293b; /* Dark Mode */
        color: #f1f5f9;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    header {
        padding: 1rem;
        font-size: 1.5rem;
        font-weight: bold;
        text-align: center;
        background-color: #0f172a;
        width: 100%;
        box-shadow: 0 2px 5px rgba(0,0,0,0.5);
    }
    #warmwasser {
        font-size: 2.5rem;
        font-weight: bold;
        margin: 1rem 0;
        color: #facc15;
        text-align: center;
    }
    svg {
        max-width: 95%;
        height: auto;
    }
    text {
        font-size: 14px;
        fill: white;
        font-weight: bold;
    }
</style>
</head>
<body>

<header>ðŸŒž Solarthermie-Anlage</header>
<div id="warmwasser">Warmwasser: -- Â°C</div>

<svg viewBox="0 0 800 500">
    <!-- Sonne -->
    <circle cx="100" cy="80" r="40" fill="#facc15"/>
    <text x="70" y="140" id="Temperature Sonnenkollektor">Sonnenkollektor: -- Â°C</text>

    <!-- Leitung -->
    <rect x="140" y="75" width="200" height="10" fill="#f97316"/>

    <!-- Pufferspeicher -->
    <rect x="350" y="50" width="80" height="200" fill="#64748b"/>
    <text x="360" y="280" id="Puffer oben 1">Puffer oben 1: -- Â°C</text>
    <text x="360" y="300" id="Puffer oben 2">Puffer oben 2: -- Â°C</text>
    <text x="360" y="320" id="Puffer mitte">Puffer mitte: -- Â°C</text>
    <text x="360" y="340" id="Puffer unten 2">Puffer unten 2: -- Â°C</text>
    <text x="360" y="360" id="T16">T16: -- Â°C</text>

    <!-- Warmwasser -->
    <rect x="500" y="80" width="60" height="120" fill="#0ea5e9"/>
    <text x="500" y="230" id="Warmwasser">Warmwasser: -- Â°C</text>

    <!-- Kessel -->
    <rect x="650" y="150" width="80" height="100" fill="#ef4444"/>
    <text x="650" y="270" id="Kessel Vorlauf">Kessel Vorlauf: -- Â°C</text>
    <text x="650" y="290" id="Kessel RÃ¼cklauf">Kessel RÃ¼cklauf: -- Â°C</text>
    <text x="650" y="310" id="Holzkessel">Holzkessel: -- Â°C</text>
</svg>

<script>
async function updateData() {
    try {
        const res = await fetch('/api/current');
        const data = await res.json();
        if (!data.ok) return;

        const vals = data.values;

        for (const [label, value] of Object.entries(vals)) {
            const el = document.getElementById(label);
            if (el) {
                el.textContent = `${label}: ${value.toFixed(1)} Â°C`;
                // Farbe abhÃ¤ngig von Temperatur
                let color = "#3b82f6"; // blau
                if (value >= 20) color = "#22c55e"; // grÃ¼n
                if (value >= 40) color = "#f97316"; // orange
                if (value >= 60) color = "#ef4444"; // rot
                el.setAttribute("fill", color);
            }
        }

        if (vals["Warmwasser"] !== undefined) {
            document.getElementById("warmwasser").textContent =
                `Warmwasser: ${vals["Warmwasser"].toFixed(1)} Â°C`;
        }

    } catch (err) {
        console.error("Fehler beim Abrufen:", err);
    }
}

updateData();
setInterval(updateData, 30000);
</script>

</body>
</html>
